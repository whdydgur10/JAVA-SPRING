<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.green.project.dao.InformationDao">
	<select id="getLevelNum" resultType="int">
		select level from level where userId = #{id}
	</select>
	<select id="getCouponNum" resultType="int">
		select count(*) from coupon where userId = #{id}
	</select>
	<select id="getPurchaseListNum" resultType="int">
		select count(*) from purchaseList
							join (select * from purchase where userId = #{id}) as pc
							where purchaseNum = pc.num
	</select>
	<select id="getVaginalNum" resultType="int">
		select count(*) from vaginal where userId = #{id}
	</select>
	<select id="getShoppingBasketNum" resultType="int">
		select count(*) from shoppingBasket where userId = #{id}
	</select>
	<select id="getReviewNum" resultType="int">
		select count(*) from review where userId = #{id}
	</select>
	<select id="getMainAddress" resultType="kr.green.project.vo.AddressVo">
		select * from address where userId = #{id} and isMain = 'Y'
	</select>
	<select id="getSubAddressList" resultType="kr.green.project.vo.AddressVo">
		select * from address where userId = #{id} and isMain = 'N'
	</select>
	<select id="getaddressList" resultType="kr.green.project.vo.AddressVo">
		select * from address where userId = #{id}
	</select>
	<insert id="insertAddress">
		insert into address(userId, code, address, detail, isMain) values(#{user.id}, #{address.code}, #{address.address}, #{address.detail}, #{address.isMain})
	</insert>
	<update id="updateIsSub">
		update address set isMain = 'N' where userId = #{id} and isMain = 'Y'
	</update>
	<update id="updateIsMain">
		update address set isMain = 'Y' where num = #{num}
	</update>
	<delete id="deleteAddress">
		delete from address where num = #{num}
	</delete>
	<select id="getLevel" resultType="kr.green.project.subVo.LevelPointVo">
		select * from level
					join (select * from point) as point
					where level.level = point.level and level.userId = #{id}
	</select>
	<select id="getPurchasePrice" resultType="String">
		select sum(price) from purchase where userId = #{id}
	</select>
	<select id="getPointList" resultType="kr.green.project.vo.PointVo">
		select * from point
	</select>
	<select id="getUsePoint" resultType="String">
		select sum(usePoint) from purchase where userId = #{id}
	</select>
	<select id="getNeedPrice" resultType="String">
		select needPrice from point
							join (select * from level where userId = #{id}) as level
							where point.level = level.level
	</select>
	<select id="getPurchase" resultType="kr.green.project.vo.PurchaseVo">
		select * from purchase where userId = #{id} and situation = '상품 도착' order by num DESC
	</select>
	<select id="getUsePointPurchase" resultType="kr.green.project.vo.PurchaseVo">
		select * from purchase where userId = #{id} and situation = '상품 도착' and isPoint = 'Y' order by num DESC
	</select>
	<select id="getCouponList" resultType="kr.green.project.vo.CouponVo">
		select * from coupon where userId = #{id} and purchaseNum is null
	</select>
	<select id="isCouponCode" resultType="kr.green.project.vo.CouponVo">
		select * from coupon where code = #{code} and userId = 'root'
	</select>
	<insert id="insertCoupon">
		insert into coupon(code, discount, userId ,name) values(#{coupon.code}, #{coupon.discount}, #{id}, #{coupon.name})
	</insert>
	<select id="getUseCouponList" resultType="kr.green.project.vo.CouponVo">
		select * from coupon where userId = #{id} and purchaseNum is not null
	</select>
	<select id="isGetCoupon" resultType="kr.green.project.vo.CouponVo">
		select * from coupon where userId = #{id} and code = #{code}
	</select>
	<select id="getPurchaseList" resultType="kr.green.project.vo.PurchaseVo">
		select * from purchase where userId = #{id} order by num DESC
	</select>
	<select id="getVaginalList" resultType="kr.green.project.vo.VaginalVo">
		select * from vaginal where userId = #{id} order by num DESC
	</select>
</mapper>
